<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jazz 16th Randomizer (1e+a ¬∑ 4/4)</title>
  <style>
    :root{
      --bg:#0b0d12;--panel:#141822;--panel-2:#0f1320;--text:#e6e9f0;--muted:#8b94a7;
      --accent:#5fd4ff;--accent-2:#a2ff7a;--grid:#2a3142;--active:#5fd4ff22;--active-border:#5fd4ffcc;
      --focus:#a2ff7a;
    }
    *{box-sizing:border-box}
    body{margin:0;padding:24px;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:var(--text)}
    .app{max-width:920px;margin:0 auto}
    h1{font-size:1.6rem;margin:0 0 10px 0}
    .sub{color:var(--muted);margin-bottom:18px}
    .card{background:var(--panel);border:1px solid var(--grid);border-radius:16px;padding:16px}
    .controls{display:flex;flex-wrap:wrap;gap:10px 12px;align-items:center;margin-bottom:14px}
    .controls label{font-size:14px;color:var(--muted)}
    select,button,input[type=number]{appearance:none;border:1px solid var(--grid);background:var(--panel);color:var(--text);border-radius:12px;padding:6px 10px;font-size:14px}
    button{cursor:pointer}
    .grid{display:grid;grid-template-columns:repeat(16,1fr);gap:6px}
    .cell{height:40px;border-radius:8px;border:1px dashed var(--grid);cursor:pointer}
    .cell[data-active="true"]{background:var(--active);border:1px solid var(--active-border)}
    .cell[data-playing="true"]{outline:2px solid var(--accent-2)}
    .labels{display:grid;grid-template-columns:repeat(16,1fr);gap:6px;margin-bottom:4px}
    .label{text-align:center;font-size:12px;color:var(--muted)}
    .label.beat{color:var(--text);font-weight:600}
    pre{margin:0;padding:8px;background:var(--panel-2);border-radius:8px}
  </style>
</head>
<body>
  <div class="app">
    <h1>Beat Segmentation 16 Slot Randomizer</h1>
    <div class="sub">Click squares to toggle notes. Choose a preset (or randomize). Press ‚ñ∂Ô∏è to play.</div>

    <div class="card">
      <div class="controls">
        <label>Preset
          <select id="preset">
            <option value="-1" selected>‚Äî Pick a preset (50) ‚Äî</option>
          </select>
        </label>

        <label>Density
          <select id="density">
            <option value="sparse">Sparse</option>
            <option value="medium" selected>Medium</option>
            <option value="busy">Busy</option>
          </select>
        </label>

        <label><input type="checkbox" id="ensure" checked /> Ensure ‚â•1/beat</label>
        <label>BPM <input id="bpm" type="number" value="120" min="40" max="240"/></label>
        <button id="play">‚ñ∂Ô∏è Play</button>
        <button id="randomize">üé≤ Randomize</button>
        <button id="clear">Clear</button>
      </div>

      <div class="labels" id="labels"></div>
      <div class="grid" id="grid"></div>
      <pre id="notation"></pre>
    </div>
  </div>

<script>
const gridEl = document.getElementById('grid');
const labelsEl = document.getElementById('labels');
const densEl = document.getElementById('density');
const ensureEl = document.getElementById('ensure');
const bpmEl = document.getElementById('bpm');
const btnPlay = document.getElementById('play');
const btnRandom = document.getElementById('randomize');
const btnClear = document.getElementById('clear');
const notationEl = document.getElementById('notation');
const presetEl = document.getElementById('preset');

let pattern = new Array(16).fill(false);
const subLabels = ['1','e','+','a'];

// --- 50 Presets (adapted to a 16-step 1e+a grid) ---
/* Bits: 16-char string, left->right = 1 e + a | 2 e + a | 3 e + a | 4 e + a
   1 = note-on, 0 = rest. Names reflect common feels; adaptations kept simple. */
const PRESETS = [
  {name:'Quarter Notes (1-2-3-4)', bits:'1000100010001000'},
  {name:'Straight 8ths',            bits:'1010101010101010'},
  {name:'Straight 16ths',           bits:'1111111111111111'},
  {name:'Offbeat 8ths ("&s")',      bits:'0010001000100010'},
  {name:'Backbeat (2 & 4)',         bits:'0000100000001000'},
  {name:'Half-Time Backbeat',       bits:'1000000010000000'},
  {name:'Four on the Floor',        bits:'1000100010001000'},
  {name:'Rock Train Beat',          bits:'1011101110111011'},
  {name:'Funk 16th Offbeats',       bits:'0101010001010100'},
  {name:'Charleston',               bits:'1001000010000000'},
  {name:'Charleston (Inverted)',    bits:'1000000010010000'},
  {name:'Bo Diddley (adapted)',     bits:'1000100100101000'},
  {name:'Tresillo (3-3-2)',         bits:'1000001000001000'},
  {name:'Habanera',                 bits:'1000101000001000'},
  {name:'Son Clave 3-2 (adapted)',  bits:'1000100100001001'},
  {name:'Son Clave 2-3 (adapted)',  bits:'1000100001001001'},
  {name:'Rumba Clave 3-2 (adapted)',bits:'1001000100001001'},
  {name:'Rumba Clave 2-3 (adapted)',bits:'1001000010010001'},
  {name:'Bossa Nova (skeleton)',    bits:'1000100100001000'},
  {name:'Samba (skeleton)',         bits:'1010010010100100'},
  {name:'Cha-Cha (skeleton)',       bits:'1000100000101000'},
  {name:'Bolero (skeleton)',        bits:'1000001000000100'},
  {name:'Salsa Cascara (adapted)',  bits:'1001000100100010'},
  {name:'Afro-Cuban 6/8 (straight)',bits:'1001001001001000'},
  {name:'Second Line (skeleton)',   bits:'1010011010010010'},
  {name:'Reggae One-Drop (adapted)',bits:'0000100010000000'},
  {name:'Dub Skank Offbeats',       bits:'0010001000100010'},
  {name:'Disco',                    bits:'1000100010001010'},
  {name:'House 16ths',              bits:'1010101010101010'},
  {name:'Techno Gallop',            bits:'1100100011001000'},
  {name:'Metal Gallop',             bits:'1100110011001100'},
  {name:'New Jack Swing',           bits:'1000110010001100'},
  {name:'Hip-Hop Boom-Bap',         bits:'1000000100001000'},
  {name:'Trap Hats Triplet-ish',    bits:'1010011010100110'},
  {name:'Amen (skeleton)',          bits:'1000100010110010'},
  {name:'Purdie Shuffle (skel.)',   bits:'1010011010100100'},
  {name:'Rosanna Shuffle (skel.)',  bits:'1010011010010100'},
  {name:'Shuffle 12/8 Feel',        bits:'1101101101101100'},
  {name:'Motown 2&4 + pushes',      bits:'1000101000001000'},
  {name:'Synco-Pop ‚Äô80s',           bits:'1000010010000100'},
  {name:'Clave + Anticipation',     bits:'1000100000101000'},
  {name:'Clave-Tresillo Fusion',    bits:'1000100001001000'},
  {name:'Dembow (adapted)',         bits:'1000100010101000'},
  {name:'Reggaeton (boom-chick)',   bits:'1000100010000100'},
  {name:'Soca (adapted)',           bits:'1010100010101000'},
  {name:'Merengue (adapted)',       bits:'1010101010001010'},
  {name:'Breakbeat Lite',           bits:'1010001010100010'},
  {name:'Neo-Soul Pocket',          bits:'1000001000100001'},
  {name:'Lo-Fi Laidback',           bits:'1000000100100001'},
  {name:'Minimal Off-Grid',         bits:'1000000000100000'},
  {name:'Clap on 2 & 4',            bits:'0000100000001000'}
];

// UI builders
function buildLabels(){
  for(let b=0;b<4;b++){
    for(let s=0;s<4;s++){
      const d=document.createElement('div');
      d.className='label '+(s===0?'beat':'');
      d.textContent=(s===0?b+1:subLabels[s]);
      labelsEl.appendChild(d);
    }
  }
}
function buildGrid(){
  for(let i=0;i<16;i++){
    const btn=document.createElement('div');
    btn.className='cell'; btn.dataset.index=i; btn.dataset.active='false';
    btn.addEventListener('click',()=>{pattern[i]=!pattern[i];render();});
    gridEl.appendChild(btn);
  }
}
function buildPresets(){
  PRESETS.forEach((p,idx)=>{
    const opt=document.createElement('option');
    opt.value=idx; opt.textContent=`${String(idx+1).padStart(2,'0')} ¬∑ ${p.name}`;
    presetEl.appendChild(opt);
  });
  presetEl.addEventListener('change',()=>{
    const i=+presetEl.value;
    if(i>=0){ loadBits(PRESETS[i].bits); render(); }
  });
}

// Randomizer helpers
function probFromDensity(){
  if(densEl.value==='sparse') return 0.25;
  if(densEl.value==='busy') return 0.7;
  return 0.5;
}
function randomize(){
  const p=probFromDensity();
  for(let i=0;i<16;i++) pattern[i]=Math.random()<p;
  if(ensureEl.checked){
    for(let b=0;b<4;b++){
      const seg=pattern.slice(b*4,b*4+4);
      if(!seg.some(Boolean)) pattern[b*4+Math.floor(Math.random()*4)]=true;
    }
  }
  // reset preset selection since it's now custom
  presetEl.value = "-1";
  render();
}

// Rendering / notation
function patternToNotation(){
  let lines=[];
  for(let b=0;b<4;b++){
    const seg=pattern.slice(b*4,b*4+4);
    let tokens=[];
    for(let s=0;s<4;s++){ if(seg[s]) tokens.push(s===0?String(b+1):subLabels[s]); }
    lines.push(tokens.length?tokens.join(' '):'‚Äî');
  }
  return lines.join('\n');
}
function render(){
  [...gridEl.children].forEach((el,i)=>{el.dataset.active=pattern[i];});
  notationEl.textContent=patternToNotation();
}
function loadBits(str){
  for(let i=0;i<16;i++) pattern[i] = str[i]==='1';
}

// Audio playback
let ac=null,isPlaying=false,curr=0,nextTime=0,timer;
function getBPM(){return Math.min(240,Math.max(40,parseInt(bpmEl.value)||120));}
function sp16(){return 60/(getBPM()*4);}
function initAudio(){if(!ac) ac=new (window.AudioContext||window.webkitAudioContext)();}
function clickAt(time,step){
  const osc=ac.createOscillator(); const g=ac.createGain();
  const down=step%4===0; osc.type='square';
  osc.frequency.setValueAtTime(down?1000:700,time);
  g.gain.setValueAtTime(0.2,time); g.gain.exponentialRampToValueAtTime(0.001,time+0.1);
  osc.connect(g).connect(ac.destination); osc.start(time); osc.stop(time+0.1);
}
function highlight(step){[...gridEl.children].forEach((el,i)=>el.dataset.playing=(i===step));}
function schedule(step,time){
  if(pattern[step]) clickAt(time,step);
  setTimeout(()=>highlight(step),Math.max(0,(time-ac.currentTime)*1000));
}
function nextStep(){nextTime+=sp16();curr=(curr+1)%16;}
function scheduler(){
  while(nextTime<ac.currentTime+0.1){schedule(curr,nextTime);nextStep();}
  timer=setTimeout(scheduler,25);
}
function start(){initAudio(); if(ac.state==='suspended') ac.resume();
  isPlaying=true; btnPlay.textContent='‚èπ Stop'; curr=0; nextTime=ac.currentTime+0.05; scheduler();}
function stop(){isPlaying=false; btnPlay.textContent='‚ñ∂Ô∏è Play'; clearTimeout(timer);
  [...gridEl.children].forEach(el=>el.dataset.playing=false);}

// Events
btnPlay.addEventListener('click',()=>{isPlaying?stop():start();});
btnRandom.addEventListener('click',randomize);
btnClear.addEventListener('click',()=>{pattern.fill(false);presetEl.value="-1";render();});

// Init
function init(){ buildLabels(); buildGrid(); buildPresets(); randomize(); }
init();
</script>
</body>
</html>